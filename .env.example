# Local development env example (no real secrets).
# Copy to `.env` and adjust values for your environment.

ENV=dev
SHAMELL_DEPLOYMENT_PROFILE=root-dev

# Postgres
POSTGRES_USER=shamell
POSTGRES_PASSWORD=shamell
POSTGRES_DB=postgres
POSTGRES_DB_CORE=shamell_core
POSTGRES_DB_CHAT=shamell_chat
POSTGRES_DB_PAYMENTS=shamell_payments
POSTGRES_DB_BUS=shamell_bus

DB_URL=postgresql://shamell:shamell@db:5432/shamell_core
CHAT_DB_URL=postgresql://shamell:shamell@db:5432/shamell_chat
PAYMENTS_DB_URL=postgresql://shamell:shamell@db:5432/shamell_payments
BUS_DB_URL=postgresql://shamell:shamell@db:5432/shamell_bus

# Internal service auth
INTERNAL_API_SECRET=change-me-dev-internal-secret
BFF_SECURITY_ALERT_ALLOWED_CALLERS=security-reporter
BFF_INTERNAL_SERVICE_ID=bff
CHAT_REQUIRE_INTERNAL_SECRET=true
PAYMENTS_REQUIRE_INTERNAL_SECRET=true
BUS_REQUIRE_INTERNAL_SECRET=true
PAYMENTS_INTERNAL_SECRET=change-me-dev-payments-secret
PAYMENTS_INTERNAL_ALLOWED_CALLERS=bff
BUS_PAYMENTS_INTERNAL_SECRET=change-me-dev-bus-payments-secret
CHAT_INTERNAL_SECRET=change-me-dev-chat-secret
CHAT_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SECRET=change-me-dev-bus-secret
BUS_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SERVICE_ID=bus
BUS_TICKET_SECRET=change-me-dev-bus-ticket-secret

# BFF edge authz hardening
BFF_REQUIRE_INTERNAL_SECRET=true
BFF_ENFORCE_ROUTE_AUTHZ=false
BFF_ROLE_HEADER_SECRET=change-me-dev-role-secret
CSRF_GUARD_ENABLED=false
AUTH_ACCEPT_LEGACY_SESSION_COOKIE=true
AUTH_DEVICE_LOGIN_WEB_ENABLED=true
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=false
CSP_ENABLED=true

# Auth abuse guardrails (dev defaults; tighten in staging/prod)
AUTH_ACCOUNT_CREATE_WINDOW_SECS=86400
AUTH_ACCOUNT_CREATE_MAX_PER_IP=500
AUTH_ACCOUNT_CREATE_MAX_PER_DEVICE=3
AUTH_ACCOUNT_CREATE_ENABLED=true
AUTH_ACCOUNT_CREATE_POW_ENABLED=false
AUTH_ACCOUNT_CREATE_POW_TTL_SECS=300
AUTH_ACCOUNT_CREATE_POW_DIFFICULTY_BITS=18
AUTH_ACCOUNT_CREATE_POW_SECRET=change-me-dev-account-create-pow-secret
AUTH_ACCOUNT_CREATE_HARDWARE_ATTESTATION_ENABLED=false
AUTH_ACCOUNT_CREATE_REQUIRE_HARDWARE_ATTESTATION=false
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_TEAM_ID=
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_KEY_ID=
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_PRIVATE_KEY_P8_B64=
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_SERVICE_ACCOUNT_JSON_B64=
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_ALLOWED_PACKAGE_NAMES=online.shamell.app,online.shamell.app.operator,online.shamell.app.admin
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_STRONG_INTEGRITY=false
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_PLAY_RECOGNIZED=false
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_LICENSED=false
AUTH_ACCOUNT_CREATE_CHALLENGE_WINDOW_SECS=300
AUTH_ACCOUNT_CREATE_CHALLENGE_MAX_PER_IP=2000
AUTH_ACCOUNT_CREATE_CHALLENGE_MAX_PER_DEVICE=60
AUTH_BIOMETRIC_TOKEN_TTL_SECS=31536000
AUTH_BIOMETRIC_LOGIN_WINDOW_SECS=300
AUTH_BIOMETRIC_LOGIN_MAX_PER_IP=60
AUTH_BIOMETRIC_LOGIN_MAX_PER_DEVICE=30
AUTH_CHAT_REGISTER_WINDOW_SECS=300
AUTH_CHAT_REGISTER_MAX_PER_IP=80
AUTH_CHAT_REGISTER_MAX_PER_DEVICE=30
AUTH_CHAT_GET_DEVICE_WINDOW_SECS=300
AUTH_CHAT_GET_DEVICE_MAX_PER_IP=120
AUTH_CHAT_GET_DEVICE_MAX_PER_DEVICE=60
AUTH_CHAT_SEND_WINDOW_SECS=60
AUTH_CHAT_SEND_MAX_PER_IP=5000
AUTH_CHAT_SEND_MAX_PER_DEVICE=240
# Best practice (prod/staging default): require an invite-established contact edge before allowing
# direct message sends. In dev/test this defaults to false for convenience.
AUTH_CHAT_SEND_REQUIRE_CONTACTS=false
AUTH_CHAT_GROUP_SEND_WINDOW_SECS=60
AUTH_CHAT_GROUP_SEND_MAX_PER_IP=5000
AUTH_CHAT_GROUP_SEND_MAX_PER_DEVICE=240
AUTH_DEVICE_LOGIN_WINDOW_SECS=300
AUTH_DEVICE_LOGIN_START_MAX_PER_IP=50
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_IP=120
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_PHONE=60
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_TOKEN=120
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_TOKEN=60
AUTH_CONTACT_INVITE_TTL_SECS=86400
AUTH_CONTACT_INVITE_WINDOW_SECS=300
AUTH_CONTACT_INVITE_CREATE_MAX_PER_IP=120
AUTH_CONTACT_INVITE_CREATE_MAX_PER_PHONE=60
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_IP=500
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_PHONE=120
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_TOKEN=10
AUTH_MAINTENANCE_INTERVAL_SECS=600
AUTH_SESSION_IDLE_TTL_SECS=43200
AUTH_SESSION_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_LOGIN_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_SESSION_RETENTION_SECS=2592000
AUTH_RATE_LIMIT_RETENTION_SECS=86400
SECURITY_ALERT_WINDOW_SECS=300
SECURITY_ALERT_COOLDOWN_SECS=600
SECURITY_ALERT_THRESHOLDS=device_login_approve.blocked:20,device_login_redeem.blocked:20,biometric_login.blocked:20,biometric_token_rotate.failed:1,auth_rate_limit_exceeded.blocked:200
SECURITY_ALERT_WEBHOOK_URL=http://127.0.0.1:8080/internal/security/alerts
SECURITY_ALERT_WEBHOOK_INTERNAL_SECRET=
SECURITY_ALERT_WEBHOOK_SERVICE_ID=security-reporter

# CORS / host allowlists
ALLOWED_HOSTS=localhost,127.0.0.1
ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# Upstream service wiring
CHAT_BASE_URL=http://chat:8081
PAYMENTS_BASE_URL=http://payments:8082
BUS_BASE_URL=http://bus:8083
CHAT_MAILBOX_API_ENABLED=false
CHAT_MAX_BODY_BYTES=2097152

# Payments
PAYMENTS_ALLOW_DIRECT_TOPUP=true
FEE_WALLET_ACCOUNT_ID=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
# Optional legacy fallback (prefer FEE_WALLET_ACCOUNT_ID)
FEE_WALLET_PHONE=

# LiveKit dev defaults (rotate for staging/prod)
LIVEKIT_API_KEY=devkey
LIVEKIT_API_SECRET=devsecret
LIVEKIT_PUBLIC_URL=
LIVEKIT_TOKEN_ENDPOINT_ENABLED=false
