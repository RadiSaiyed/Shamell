# Local development env example (no real secrets).
# Copy to `.env` and adjust values for your environment.

ENV=dev

# Postgres
POSTGRES_USER=shamell
POSTGRES_PASSWORD=shamell
POSTGRES_DB=postgres
POSTGRES_DB_CORE=shamell_core
POSTGRES_DB_CHAT=shamell_chat
POSTGRES_DB_PAYMENTS=shamell_payments
POSTGRES_DB_BUS=shamell_bus

DB_URL=postgresql://shamell:shamell@db:5432/shamell_core
CHAT_DB_URL=postgresql://shamell:shamell@db:5432/shamell_chat
PAYMENTS_DB_URL=postgresql://shamell:shamell@db:5432/shamell_payments
BUS_DB_URL=postgresql://shamell:shamell@db:5432/shamell_bus

# Internal service auth
INTERNAL_API_SECRET=change-me-dev-internal-secret
BFF_INTERNAL_ALLOWED_CALLERS=edge
BFF_SECURITY_ALERT_ALLOWED_CALLERS=security-reporter
BFF_INTERNAL_SERVICE_ID=bff
PAYMENTS_INTERNAL_SECRET=change-me-dev-payments-secret
PAYMENTS_INTERNAL_ALLOWED_CALLERS=bff
BUS_PAYMENTS_INTERNAL_SECRET=change-me-dev-bus-payments-secret
CHAT_INTERNAL_SECRET=change-me-dev-chat-secret
CHAT_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SECRET=change-me-dev-bus-secret
BUS_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SERVICE_ID=bus
BUS_TICKET_SECRET=change-me-dev-bus-ticket-secret

# BFF edge authz hardening
BFF_REQUIRE_INTERNAL_SECRET=true
BFF_ENFORCE_ROUTE_AUTHZ=false
BFF_ROLE_HEADER_SECRET=change-me-dev-role-secret
CSRF_GUARD_ENABLED=false
AUTH_ACCEPT_LEGACY_SESSION_COOKIE=true
AUTH_ALLOW_HEADER_SESSION_AUTH=true
AUTH_BLOCK_BROWSER_HEADER_SESSION=true
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=false
CSP_ENABLED=true

# Auth abuse guardrails (dev defaults; tighten in staging/prod)
AUTH_EXPOSE_CODES=false
AUTH_REQUEST_CODE_WINDOW_SECS=300
AUTH_REQUEST_CODE_MAX_PER_IP=50
AUTH_REQUEST_CODE_MAX_PER_PHONE=10
AUTH_VERIFY_WINDOW_SECS=300
AUTH_VERIFY_MAX_PER_IP=100
AUTH_VERIFY_MAX_PER_PHONE=20
AUTH_VERIFY_MAX_ATTEMPTS_PER_CODE=5
AUTH_OTP_PEPPER=change-me-dev-otp-pepper
AUTH_RESOLVE_PHONE_WINDOW_SECS=300
AUTH_RESOLVE_PHONE_MAX_PER_PHONE=30
AUTH_RESOLVE_PHONE_MAX_PER_IP=120
AUTH_CHAT_REGISTER_WINDOW_SECS=300
AUTH_CHAT_REGISTER_MAX_PER_IP=80
AUTH_CHAT_REGISTER_MAX_PER_DEVICE=30
AUTH_CHAT_GET_DEVICE_WINDOW_SECS=300
AUTH_CHAT_GET_DEVICE_MAX_PER_IP=120
AUTH_CHAT_GET_DEVICE_MAX_PER_DEVICE=60
AUTH_DEVICE_LOGIN_WINDOW_SECS=300
AUTH_DEVICE_LOGIN_START_MAX_PER_IP=50
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_IP=120
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_PHONE=60
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_TOKEN=120
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_TOKEN=60
AUTH_MAINTENANCE_INTERVAL_SECS=600
AUTH_SESSION_IDLE_TTL_SECS=43200
AUTH_SESSION_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_LOGIN_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_SESSION_RETENTION_SECS=2592000
AUTH_RATE_LIMIT_RETENTION_SECS=86400
SECURITY_ALERT_WINDOW_SECS=300
SECURITY_ALERT_COOLDOWN_SECS=600
SECURITY_ALERT_THRESHOLDS=header_session_auth_rejected.blocked:10,device_login_approve.blocked:20,device_login_redeem.blocked:20,auth_rate_limit_exceeded.blocked:200
SECURITY_ALERT_WEBHOOK_URL=http://127.0.0.1:8080/internal/security/alerts
SECURITY_ALERT_WEBHOOK_INTERNAL_SECRET=
SECURITY_ALERT_WEBHOOK_SERVICE_ID=security-reporter

# CORS / host allowlists
ALLOWED_HOSTS=localhost,127.0.0.1
ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# Upstream service wiring
CHAT_BASE_URL=http://chat:8081
PAYMENTS_BASE_URL=http://payments:8082
BUS_BASE_URL=http://bus:8083

# Payments
PAYMENTS_ALLOW_DIRECT_TOPUP=true

# LiveKit dev defaults (rotate for staging/prod)
LIVEKIT_API_KEY=devkey
LIVEKIT_API_SECRET=devsecret
LIVEKIT_PUBLIC_URL=
LIVEKIT_TOKEN_ENDPOINT_ENABLED=false
