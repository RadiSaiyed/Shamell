name: Flutter Android Beta (Build)

'on':
  workflow_dispatch: {}

jobs:
  android-beta:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Checkout
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0

      - name: Setup Flutter
        uses: subosito/flutter-action@fd55f4c5af5b953cc57a2be44cb082c8f6635e8e # v2.21.0
        with:
          channel: stable

      - name: Flutter pub get
        working-directory: clients/shamell_flutter
        run: flutter pub get

      - name: Build appbundle
        working-directory: clients/shamell_flutter
        run: flutter build appbundle --release --flavor user

      - name: Resolve built AAB path
        working-directory: clients/shamell_flutter
        run: |
          AAB_REL_PATH="$(find build/app/outputs/bundle -type f -name '*.aab' | head -n 1)"
          if [ -z "${AAB_REL_PATH}" ]; then
            echo "::error::No .aab found under build/app/outputs/bundle"
            exit 1
          fi
          echo "AAB_PATH=${GITHUB_WORKSPACE}/clients/shamell_flutter/${AAB_REL_PATH}" >> "$GITHUB_ENV"

      - name: Upload Android appbundle artifact
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        with:
          name: shamell-android-user-release-aab
          path: ${{ env.AAB_PATH }}
          if-no-files-found: error
