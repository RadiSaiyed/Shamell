# Shamell BFF edge hardening:
# 1) never trust security-sensitive headers from the public Internet
# 2) inject internal attestation headers from host-local snippets only
# 3) optionally set trusted role headers via a host-local attestation snippet

# Internal service auth must never be client-controlled.
proxy_set_header X-Internal-Secret "";
include /etc/nginx/snippets/shamell_bff_internal_auth.local.conf;
# Edge caller identity used by BFF internal caller allowlist.
proxy_set_header X-Internal-Service-Id "edge";

# Client IP used by BFF auth/rate-limit logic. This always overwrites any
# client-supplied value and carries the trusted edge-derived remote address.
proxy_set_header X-Shamell-Client-IP $remote_addr;

# Route-level AuthZ headers must not be accepted directly from clients.
proxy_set_header X-Auth-Roles "";
proxy_set_header X-Roles "";
proxy_set_header X-Role-Auth "";

# Optional host-local override (kept outside git history).
# This file can re-set role headers from a trusted edge/auth component.
include /etc/nginx/snippets/shamell_bff_role_attestation.local.conf;
