# Shamell staging env template (Rust + Postgres)
ENV=staging

# Required secrets
INTERNAL_API_SECRET=change-me
BFF_SECURITY_ALERT_ALLOWED_CALLERS=security-reporter
BFF_INTERNAL_SERVICE_ID=bff
PAYMENTS_INTERNAL_SECRET=change-me
PAYMENTS_INTERNAL_ALLOWED_CALLERS=bff
BUS_PAYMENTS_INTERNAL_SECRET=change-me
CHAT_INTERNAL_SECRET=change-me
CHAT_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SECRET=change-me
BUS_INTERNAL_ALLOWED_CALLERS=bff
BUS_INTERNAL_SERVICE_ID=bus
BUS_TICKET_SECRET=change-me
BFF_ROLE_HEADER_SECRET=change-me

# Postgres
POSTGRES_USER=shamell
POSTGRES_PASSWORD=change-me
POSTGRES_DB=postgres
POSTGRES_DB_CORE=shamell_core
POSTGRES_DB_CHAT=shamell_chat
POSTGRES_DB_PAYMENTS=shamell_payments
POSTGRES_DB_BUS=shamell_bus

DB_URL=postgresql://shamell:change-me@db:5432/shamell_core
CHAT_DB_URL=postgresql://shamell:change-me@db:5432/shamell_chat
PAYMENTS_DB_URL=postgresql://shamell:change-me@db:5432/shamell_payments
BUS_DB_URL=postgresql://shamell:change-me@db:5432/shamell_bus

# BFF security controls
BFF_REQUIRE_INTERNAL_SECRET=true
BFF_ENFORCE_ROUTE_AUTHZ=true
CSRF_GUARD_ENABLED=true
AUTH_ACCEPT_LEGACY_SESSION_COOKIE=false
AUTH_ALLOW_HEADER_SESSION_AUTH=false
AUTH_BLOCK_BROWSER_HEADER_SESSION=true
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=true
CSP_ENABLED=true
BFF_EXPOSE_UPSTREAM_ERRORS=false
BFF_MAX_BODY_BYTES=1048576
BFF_MAX_UPSTREAM_BODY_BYTES=1048576
AUTH_BIOMETRIC_TOKEN_TTL_SECS=31536000
AUTH_BIOMETRIC_LOGIN_WINDOW_SECS=300
AUTH_BIOMETRIC_LOGIN_MAX_PER_IP=60
AUTH_BIOMETRIC_LOGIN_MAX_PER_DEVICE=30
AUTH_CHAT_REGISTER_WINDOW_SECS=300
AUTH_CHAT_REGISTER_MAX_PER_IP=40
AUTH_CHAT_REGISTER_MAX_PER_DEVICE=20
AUTH_CHAT_GET_DEVICE_WINDOW_SECS=300
AUTH_CHAT_GET_DEVICE_MAX_PER_IP=80
AUTH_CHAT_GET_DEVICE_MAX_PER_DEVICE=40
AUTH_CHAT_SEND_REQUIRE_CONTACTS=true
AUTH_CHAT_MAILBOX_WRITE_WINDOW_SECS=60
AUTH_CHAT_MAILBOX_WRITE_MAX_PER_IP=2000
AUTH_CHAT_MAILBOX_WRITE_MAX_PER_DEVICE=120
AUTH_CHAT_MAILBOX_WRITE_MAX_PER_MAILBOX=60
AUTH_DEVICE_LOGIN_WINDOW_SECS=300
AUTH_DEVICE_LOGIN_START_MAX_PER_IP=30
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_IP=60
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_PHONE=30
AUTH_DEVICE_LOGIN_REDEEM_MAX_PER_TOKEN=30
AUTH_DEVICE_LOGIN_APPROVE_MAX_PER_TOKEN=20
AUTH_CONTACT_INVITE_TTL_SECS=86400
AUTH_CONTACT_INVITE_WINDOW_SECS=300
AUTH_CONTACT_INVITE_CREATE_MAX_PER_IP=40
AUTH_CONTACT_INVITE_CREATE_MAX_PER_PHONE=20
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_IP=200
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_PHONE=80
AUTH_CONTACT_INVITE_REDEEM_MAX_PER_TOKEN=10
AUTH_MAINTENANCE_INTERVAL_SECS=3600
AUTH_SESSION_IDLE_TTL_SECS=43200
AUTH_SESSION_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_LOGIN_CLEANUP_GRACE_SECS=86400
AUTH_DEVICE_SESSION_RETENTION_SECS=2592000
AUTH_RATE_LIMIT_RETENTION_SECS=86400
AUTH_ACCOUNT_CREATE_WINDOW_SECS=86400
AUTH_ACCOUNT_CREATE_MAX_PER_IP=200
AUTH_ACCOUNT_CREATE_MAX_PER_DEVICE=2
AUTH_ACCOUNT_CREATE_POW_ENABLED=true
AUTH_ACCOUNT_CREATE_POW_TTL_SECS=300
AUTH_ACCOUNT_CREATE_POW_DIFFICULTY_BITS=18
AUTH_ACCOUNT_CREATE_POW_SECRET=change-me
AUTH_ACCOUNT_CREATE_HARDWARE_ATTESTATION_ENABLED=true
AUTH_ACCOUNT_CREATE_REQUIRE_HARDWARE_ATTESTATION=true
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_TEAM_ID=change-me
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_KEY_ID=change-me
AUTH_ACCOUNT_CREATE_APPLE_DEVICECHECK_PRIVATE_KEY_P8_B64=change-me
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_SERVICE_ACCOUNT_JSON_B64=change-me
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_ALLOWED_PACKAGE_NAMES=online.shamell.app,online.shamell.app.operator,online.shamell.app.admin
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_STRONG_INTEGRITY=true
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_PLAY_RECOGNIZED=true
AUTH_ACCOUNT_CREATE_GOOGLE_PLAY_INTEGRITY_REQUIRE_LICENSED=false
AUTH_ACCOUNT_CREATE_CHALLENGE_WINDOW_SECS=300
AUTH_ACCOUNT_CREATE_CHALLENGE_MAX_PER_IP=2000
AUTH_ACCOUNT_CREATE_CHALLENGE_MAX_PER_DEVICE=60
SECURITY_ALERT_WINDOW_SECS=300
SECURITY_ALERT_COOLDOWN_SECS=600
SECURITY_ALERT_SERVICE=bff,chat
SECURITY_ALERT_THRESHOLDS=header_session_auth_rejected.blocked:3,device_login_approve.blocked:5,device_login_redeem.blocked:5,biometric_login.blocked:10,biometric_token_rotate.failed:1,auth_rate_limit_exceeded.blocked:30,chat_protocol_downgrade.blocked:1,chat_key_bundle_policy.blocked:1
SECURITY_ALERT_WEBHOOK_URL=http://127.0.0.1:8080/internal/security/alerts
SECURITY_ALERT_WEBHOOK_INTERNAL_SECRET=
SECURITY_ALERT_WEBHOOK_SERVICE_ID=security-reporter

# Edge trust
ALLOWED_HOSTS=staging-api.shamell.online,localhost,127.0.0.1
ALLOWED_ORIGINS=https://online.shamell.online

# Service URLs
CHAT_BASE_URL=http://chat:8081
CHAT_PROTOCOL_V2_ENABLED=true
CHAT_PROTOCOL_V1_WRITE_ENABLED=false
CHAT_PROTOCOL_V1_READ_ENABLED=false
CHAT_PROTOCOL_REQUIRE_V2_FOR_GROUPS=true
CHAT_MAILBOX_API_ENABLED=true
CHAT_MAILBOX_INACTIVE_RETENTION_SECS=86400
CHAT_MAILBOX_CONSUMED_RETENTION_SECS=3600
PAYMENTS_BASE_URL=http://payments:8082
BUS_BASE_URL=http://bus:8083

# Payments
PAYMENTS_ALLOW_DIRECT_TOPUP=false

# LiveKit (must be strong values in staging)
LIVEKIT_PUBLIC_URL=wss://livekit.shamell.online
LIVEKIT_API_KEY=change-me
LIVEKIT_API_SECRET=change-me
LIVEKIT_TOKEN_ENDPOINT_ENABLED=false
LIVEKIT_TOKEN_TTL_SECS=300
LIVEKIT_TOKEN_MAX_TTL_SECS=3600
LIVEKIT_TOKEN_RATE_WINDOW_SECS=60
LIVEKIT_TOKEN_MAX_PER_PHONE=20
LIVEKIT_TOKEN_MAX_PER_IP=50
